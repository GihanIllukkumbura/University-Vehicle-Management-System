<!DOCTYPE html>
<html>
<head>
  <title>Map</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCi0-3NtjgA2SLfbHQw5jDrmdcPPVMl10"></script>
</head>
<body>
  <h1>Map</h1>
  <p>Latitude: <span id="latitude"></span></p>
  <p>Longitude: <span id="longitude"></span></p>

  <div id="map" style="height: 400px;"></div>

  <script>
    const ws = new WebSocket('ws://localhost:200/map');
    let map;

    ws.onmessage = function(event) {
      const data = JSON.parse(event.data);
      document.getElementById('latitude').textContent = data.latitude;
      document.getElementById('longitude').textContent = data.longitude;

      if (!map) {
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) },
          zoom: 3 // Set initial zoom level to 15
        });

        new google.maps.Marker({
          position: { lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) },
          map: map,
          title: 'Current Location'
        });
      } else {
        map.setCenter({ lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) });
        map.panTo({ lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) });

        // Update marker position
        marker.setPosition({ lat: parseFloat(data.latitude), lng: parseFloat(data.longitude) });
      }
    };
  </script>
</body>
</html>
